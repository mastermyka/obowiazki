<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ObowiÄ…zki rodzinne</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Manifest i favicon -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />

  <!-- Firebase config -->
  <script src="firebase-config.js"></script>
</head>
<body class="bg-gradient-to-br from-sky-100 to-indigo-100 min-h-screen font-sans text-gray-800 flex flex-col">

  <!-- HEADER -->
  <header class="bg-white shadow-md sticky top-0 z-10">
    <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-700">ðŸ“‹ ObowiÄ…zki Rodzinne</h1>
      <div class="text-sm text-gray-500">Rodzina: <span id="familyName" class="font-semibold">â€”</span></div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-grow max-w-4xl mx-auto w-full p-4 space-y-6">

    <!-- Dodawanie zadania -->
    <section class="bg-white/80 backdrop-blur-sm p-4 rounded-2xl shadow-sm">
      <h2 class="text-lg font-semibold mb-3 text-indigo-600">âž• Dodaj obowiÄ…zek</h2>
      <div class="flex flex-col sm:flex-row gap-3">
        <input id="taskInput" type="text" placeholder="Wpisz obowiÄ…zek..." class="flex-grow border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:outline-none" />
        <button id="addTaskBtn" class="bg-indigo-500 text-white px-5 py-2 rounded-lg hover:bg-indigo-600 transition">Dodaj</button>
      </div>
    </section>

    <!-- Lista obowiÄ…zkÃ³w -->
    <section class="bg-white/80 backdrop-blur-sm p-4 rounded-2xl shadow-sm">
      <h2 class="text-lg font-semibold mb-3 text-indigo-600">ðŸ“† Lista obowiÄ…zkÃ³w</h2>
      <ul id="taskList" class="space-y-2">
        <!-- dynamicznie generowane elementy -->
      </ul>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="text-center text-xs text-gray-500 py-4">
    Â© 2025 Twoja Rodzina | <a href="#" class="underline hover:text-indigo-600">PWA</a>
  </footer>

  <!-- TWÃ“J SKRYPT -->
  <script>
  /* ====== LOGIKA (zachowana jak wczeÅ›niej) ====== */

  const taskInput = document.getElementById('taskInput');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const taskList = document.getElementById('taskList');
  const familyNameEl = document.getElementById('familyName');

  let tasks = [];
  let familyId = localStorage.getItem('familyId') || null;

  function renderAll() {
    taskList.innerHTML = '';
    tasks.forEach((task, i) => {
      const li = document.createElement('li');
      li.className = "flex justify-between items-center bg-white border rounded-xl px-4 py-2 hover:shadow transition";
      li.innerHTML = `
        <span class="flex items-center gap-2 ${task.done ? 'line-through text-gray-400' : ''}">
          <input type="checkbox" ${task.done ? 'checked' : ''} class="accent-indigo-500" data-index="${i}">
          ${task.text}
        </span>
        <button class="text-red-500 hover:text-red-700 text-sm font-medium" data-del="${i}">UsuÅ„</button>
      `;
      taskList.appendChild(li);
    });
    familyNameEl.textContent = familyId || 'â€”';
  }

  function saveLocal() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  function loadLocal() {
    const stored = localStorage.getItem('tasks');
    if (stored) tasks = JSON.parse(stored);
  }

  addTaskBtn.addEventListener('click', () => {
    const text = taskInput.value.trim();
    if (!text) return;
    tasks.push({ text, done: false });
    taskInput.value = '';
    saveLocal();
    renderAll();
    pushToFirebase();
  });

  taskList.addEventListener('click', e => {
    const i = e.target.dataset.index;
    const del = e.target.dataset.del;
    if (i !== undefined) {
      tasks[i].done = !tasks[i].done;
    }
    if (del !== undefined) {
      tasks.splice(del, 1);
    }
    saveLocal();
    renderAll();
    pushToFirebase();
  });

  /* ===== FIREBASE ===== */
  async function tryFirebaseInit() {
    if (!window.firebaseConfig || !window.firebaseConfig.apiKey) return;
    try {
      const app = firebase.initializeApp(window.firebaseConfig);
      const db = firebase.firestore();
      if (!familyId) {
        familyId = prompt('Podaj ID rodziny:');
        localStorage.setItem('familyId', familyId);
      }
      const docRef = db.collection('organizer').doc(familyId);

      const doc = await docRef.get();
      if (doc.exists) tasks = doc.data().tasks || [];

      renderAll();

      window.pushToFirebase = async function() {
        await docRef.set({ tasks });
      };
    } catch (e) {
      console.error('Firebase init error:', e);
    }
  }

  function pushToFirebase() { /* placeholder jeÅ›li brak Firebase */ }

  /* ===== PWA SW ===== */
  const skipSW = location.search.includes('nosw=1');
  if ('serviceWorker' in navigator && !skipSW) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js').catch(() => {});
    });
  }

  /* ===== INIT ===== */
  document.addEventListener('DOMContentLoaded', () => {
    loadLocal();
    renderAll();
    tryFirebaseInit();
  });
  </script>
</body>
</html>
